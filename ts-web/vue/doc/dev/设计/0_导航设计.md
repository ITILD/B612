# 室内导航

## 需求

## 实现思路

完全数据库端实现
需要数据库支持图运算和空间运算

给建筑 id 或者楼层定位

返回值

```js
// 加时间等待
// 最短时间和路程
{
    timeFirst:[
    {
        floor:{
            floorId:'',
            name:''
        },
        startPoint:{
            name:'B0111房屋',
            type:'建筑对象',//定位点
            geom:''
        },
        startToRoadLine:{
            // 时间
            costLength:'',
            costTime:'',
            geom:''
        },
        roadLine:{
            // 时间
             costLength:'',
            costTime:'',
            geom:''
        },
        roadToEndPoint:null,
        endPoint:{
            name:'11楼东侧南方楼梯',
            type:'联通点',//定位点
            geom:''
        }
    },
    // 中间联通线路.....
    {
         floor:{
            floorId:'',
            name:''
        },
       startPoint:{
            name:'电梯楼梯名',
            type:'',//定位点
            geom:''
        },
        startToRoadLine:null,
        roadLine:{
            // 时间
             costLength:'',
            costTime:'',
            geom:''
        },
        roadToEndPoint:null,
        endPoint:{
            name:'电梯楼梯名',
            type:'联通点',//定位点
            geom:''
        }
    },
  {
        floor:{
            floorId:'',
            name:''
        },
        startPoint:{
            name:'1楼东侧南方楼梯',
            type:'联通点',//定位点
            geom:''
        },
        startToRoadLine:null,
        roadLine:{
            // 时间
             costLength:'',
            costTime:'',
            geom:''
        },
        roadToEndPoint:{
            // 时间
             costLength:'',
            costTime:'',
            geom:''
        },
        endPoint:{
            name:'B0011房屋',
            type:'联通点',//定位点
            geom:''
        }
    }
],
    lengthFirst:[
    // ....
]
}

```

### 数据库

```sql
----空数据库 添加扩展
CREATE EXTENSION pgRouting
--创建表
-- DROP TABLE public.d_road;
CREATE TABLE public.d_road (
	gid int4 NOT NULL DEFAULT nextval('dhc_road_1_gid_seq'::regclass),
	geom public.geometry(linestring, 3857) NULL,
    oneway varchar(254) NULL,
	source int4 NULL,
	target int4 NULL,
	cost float8 NULL,
	reverse_cost float8 NULL,
	time_cost varchar NULL,
	time_reverse_cost varchar NULL,
    pid varchar NULL,
    name varchar NULL,
	rout_type varchar NULL,
	CONSTRAINT dhc_road_pkey_1 PRIMARY KEY (gid)
);
CREATE INDEX dhc_road_geom_idx_1 ON public.d_road USING btree (geom);
CREATE INDEX dhc_road_source_idx_1 ON public.d_road USING btree (source);
CREATE INDEX dhc_road_target_idx_1 ON public.d_road USING btree (target);

```




## 展示查询

<!-- 两种路线 -->
<!-- 纯线 自动创建拓扑 室外有性能问题    点表和线表 自己更新拓扑 缺点是无法轻松录入外部线数据  -->
<!-- 长线路大规模最短路径 https://developer.aliyun.com/article/759319 -->



<!-- 实际没有问题  纯线表可以利用已有数据？   点会更规范??   目前采用纯线表 -->



目录

1\. 查询指定项目属性接口

---

**1\. 查询指定项目属性**
###### 接口功能
> 获取制定项目的分类信息

###### URL
> [http://www.api.com/index.php]()

###### 支持格式
> JSON

###### HTTP请求方式
> GET

###### 请求参数
>|参数|必选|类型|说明|
>|:-------------|:-------------|:-------------|-------------|
>|name    |ture    |string|请求的项目名                          |
>|type    |true    |int   |请求项目的类型。1：类型一；2：类型二 。|

###### 返回字段
> |返回字段|字段类型|说明|
> |:-------------|:-------------|:-------------|
> |status   |int    |返回结果状态。0：正常；1：错误。   |
> |company  |string | 所属公司名                      |
> |category |string |所属类型                         |

###### 接口示例
> 地址：[http://www.api.com/index.php?name="可口可乐"&type=1](http://www.api.com/index.php?name="可口可乐"&type=1)
``` javascript
{
    "statue": 0,
    "company": "可口可乐",
    "category": "饮料",
}

