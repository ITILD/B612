# 室内导航

## 需求

## 实现思路

完全数据库端实现
需要数据库支持图运算和空间运算

给建筑 id 或者楼层定位

返回值

```js
// 加时间等待
// 最短时间和路程
{
    timeFirst:[
    {
        floor:{
            floorId:'',
            name:''
        },
        startPoint:{
            name:'B0111房屋',
            type:'建筑对象',//定位点
            geom:''
        },
        startToRoadLine:{
            // 时间
            costLength:'',
            costTime:'',
            geom:''
        },
        roadLine:{
            // 时间
             costLength:'',
            costTime:'',
            geom:''
        },
        roadToEndPoint:null,
        endPoint:{
            name:'11楼东侧南方楼梯',
            type:'联通点',//定位点
            geom:''
        }
    },
    // 中间联通线路.....
    {
         floor:{
            floorId:'',
            name:''
        },
       startPoint:{
            name:'电梯楼梯名',
            type:'',//定位点
            geom:''
        },
        startToRoadLine:null,
        roadLine:{
            // 时间
             costLength:'',
            costTime:'',
            geom:''
        },
        roadToEndPoint:null,
        endPoint:{
            name:'电梯楼梯名',
            type:'联通点',//定位点
            geom:''
        }
    },
  {
        floor:{
            floorId:'',
            name:''
        },
        startPoint:{
            name:'1楼东侧南方楼梯',
            type:'联通点',//定位点
            geom:''
        },
        startToRoadLine:null,
        roadLine:{
            // 时间
             costLength:'',
            costTime:'',
            geom:''
        },
        roadToEndPoint:{
            // 时间
             costLength:'',
            costTime:'',
            geom:''
        },
        endPoint:{
            name:'B0011房屋',
            type:'联通点',//定位点
            geom:''
        }
    }
],
    lengthFirst:[
    // ....
]
}

```

### 数据库

```sql
----空数据库 添加扩展
CREATE EXTENSION pgRouting
--创建表
-- DROP TABLE public.d_road;
CREATE TABLE public.d_road (
	gid int4 NOT NULL DEFAULT nextval('dhc_road_1_gid_seq'::regclass),
	geom public.geometry(linestring, 3857) NULL,
    oneway varchar(254) NULL,
	source int4 NULL,
	target int4 NULL,
	cost float8 NULL,
	reverse_cost float8 NULL,
	time_cost varchar NULL,
	time_reverse_cost varchar NULL,
    pid varchar NULL,
    name varchar NULL,
	rout_type varchar NULL,
	CONSTRAINT dhc_road_pkey_1 PRIMARY KEY (gid)
);
CREATE INDEX dhc_road_geom_idx_1 ON public.d_road USING btree (geom);
CREATE INDEX dhc_road_source_idx_1 ON public.d_road USING btree (source);
CREATE INDEX dhc_road_target_idx_1 ON public.d_road USING btree (target);

```
